<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Password Policy Enforcer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Nunito", sans-serif;
      }
      .fade-in {
        animation: fadeIn 0.5s ease-in-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .slide-down {
        max-height: 500px;
        overflow: hidden;
        transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out;
      }
      .slide-up {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.5s ease-in-out;
        padding-top: 0 !important;
        padding-bottom: 0 !important;
        margin-top: 0 !important;
        border-width: 0 !important;
      }
      input[type="checkbox"] {
        transform: scale(1.2);
      }
    </style>
  </head>
  <body
    class="bg-gray-900 text-gray-200 flex items-center justify-center min-h-screen p-4"
  >
    <div
      class="w-full max-w-lg bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-8 border border-gray-700"
    >
      <div class="text-center mb-6">
        <h1 class="text-3xl font-bold text-white">Password Policy Enforcer</h1>
        <p class="text-gray-400 mt-2">
          Strengthen a password based on customizable security rules.
        </p>
      </div>

      <!-- Input Fields -->
      <div class="space-y-4">
        <div>
          <label
            for="username"
            class="block text-sm font-medium text-gray-400 mb-1"
            >Username</label
          >
          <input
            type="text"
            id="username"
            value="edit_me"
            class="w-full bg-gray-700 border border-gray-600 text-white rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-indigo-500 focus:outline-none transition duration-200"
            placeholder="e.g., john.doe"
          />
        </div>
        <div>
          <label
            for="candidate"
            class="block text-sm font-medium text-gray-400 mb-1"
            >Candidate Password</label
          >
          <input
            type="text"
            id="candidate"
            class="w-full bg-gray-700 border border-gray-600 text-white rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-indigo-500 focus:outline-none transition duration-200"
            placeholder="Enter a starting password (or leave blank)"
          />
        </div>
      </div>

      <!-- Policy Settings -->
      <div class="mt-4">
        <button
          id="toggle-policy-btn"
          class="w-full text-left text-indigo-400 hover:text-indigo-300 font-semibold py-2 flex justify-between items-center"
        >
          <span>Advanced Policy Settings</span>
          <svg
            id="policy-arrow"
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5 transition-transform duration-300"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
        </button>
      </div>
      <div
        id="policy-settings"
        class="slide-up mt-4 border-t border-gray-700 pt-4"
      >
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- Length -->
          <div class="space-y-4">
            <div>
              <label
                for="minL"
                class="block text-sm font-medium text-gray-400 mb-1"
                >Min Length</label
              >
              <input
                type="number"
                id="minL"
                value="8"
                class="w-full bg-gray-700 border border-gray-600 text-white rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:outline-none"
              />
            </div>
            <div>
              <label
                for="maxL"
                class="block text-sm font-medium text-gray-400 mb-1"
                >Max Length</label
              >
              <input
                type="number"
                id="maxL"
                value="16"
                class="w-full bg-gray-700 border border-gray-600 text-white rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:outline-none"
              />
            </div>
          </div>
          <!-- Requirements -->
          <div class="space-y-3 text-sm flex flex-col justify-center">
            <label class="flex items-center gap-3"
              ><input
                type="checkbox"
                id="reqLower"
                checked
                class="accent-indigo-500"
              />
              Require Lowercase</label
            >
            <label class="flex items-center gap-3"
              ><input
                type="checkbox"
                id="reqUpper"
                checked
                class="accent-indigo-500"
              />
              Require Uppercase</label
            >
            <label class="flex items-center gap-3"
              ><input
                type="checkbox"
                id="reqDigit"
                checked
                class="accent-indigo-500"
              />
              Require Digit</label
            >
            <label class="flex items-center gap-3"
              ><input
                type="checkbox"
                id="reqSpec"
                checked
                class="accent-indigo-500"
              />
              Require Special</label
            >
            <label class="flex items-center gap-3"
              ><input
                type="checkbox"
                id="noUser"
                checked
                class="accent-indigo-500"
              />
              Forbid Username</label
            >
          </div>
        </div>
        <div class="mt-4">
          <label
            for="specials"
            class="block text-sm font-medium text-gray-400 mb-1"
            >Allowed Special Characters</label
          >
          <input
            type="text"
            id="specials"
            value="!@#$%&*?-_+="
            class="w-full bg-gray-700 border border-gray-600 text-white rounded-lg px-3 py-2 font-mono focus:ring-2 focus:ring-indigo-500 focus:outline-none"
          />
        </div>
      </div>

      <!-- Enforce Button -->
      <div class="mt-6">
        <button
          id="enforce-btn"
          class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-300 shadow-lg shadow-indigo-900/50"
        >
          Enforce Policy
        </button>
      </div>

      <!-- Result Display -->
      <div id="result-container" class="mt-6 hidden">
        <label class="block text-sm font-medium text-gray-400 mb-1"
          >Secure Password</label
        >
        <div class="relative">
          <input
            readonly
            id="result"
            type="text"
            class="w-full bg-gray-900 border border-gray-600 text-green-400 font-mono rounded-lg pl-4 pr-12 py-2.5"
          />
          <button
            id="copy-btn"
            class="absolute inset-y-0 right-0 flex items-center px-4 text-gray-400 hover:text-white transition group"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
              />
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Message Box for Copy Confirmation -->
    <div
      id="message-box"
      class="fixed top-5 right-5 bg-green-500 text-white py-2 px-4 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300"
    >
      Password copied to clipboard!
    </div>

    <script>
      // --- Core Logic Translated from C++ ---

      const rand_from = (s) => s[Math.floor(Math.random() * s.length)];
      const rand_chars = (n, pool) =>
        Array.from({ length: n }, () => rand_from(pool)).join("");
      const contains_ci = (text, pat) =>
        !pat ? false : text.toLowerCase().includes(pat.toLowerCase());
      const shuffle = (a) => {
        const arr = Array.isArray(a) ? a : a.split("");
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return Array.isArray(a) ? arr : arr.join("");
      };

      /**
       * Checks if a password meets the defined security policy.
       * @param {string} pw - The password to check.
       * @param {string} username - The associated username.
       * @param {object} policy - The policy settings object.
       * @returns {boolean} True if the policy is met.
       */
      const check_policy = (pw, username, policy) => {
        if (pw.length < policy.minL || pw.length > policy.maxL) return false;
        if (policy.noUsername && username && contains_ci(pw, username))
          return false;

        const hasLower = !policy.requireLower || /[a-z]/.test(pw);
        const hasUpper = !policy.requireUpper || /[A-Z]/.test(pw);
        const hasDigit = !policy.requireDigit || /[0-9]/.test(pw);
        const hasSpec =
          !policy.requireSpec ||
          (policy.specials &&
            new RegExp(
              `[${policy.specials.replace(/[-\/\\^$*+?.()|[\]{}]/g, "\\$&")}]`
            ).test(pw));

        return hasLower && hasUpper && hasDigit && hasSpec;
      };

      /**
       * Enforces the password policy on a candidate string.
       * @param {string} candidate - The initial password string.
       * @param {string} username - The associated username.
       * @param {object} policy - The policy settings object.
       * @returns {string} A policy-compliant password.
       */
      const enforce = (candidate, username, policy) => {
        const lowers = "abcdefghijklmnopqrstuvwxyz";
        const uppers = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        const digits = "0123456789";

        // Build the master character pool based on policy
        let pool_all = "";
        if (policy.requireLower) pool_all += lowers;
        if (policy.requireUpper) pool_all += uppers;
        if (policy.requireDigit) pool_all += digits;
        if (policy.requireSpec && policy.specials) pool_all += policy.specials;
        if (pool_all.length === 0) pool_all = lowers + uppers + digits; // Fallback pool

        const remove_username = (s) => {
          if (!policy.noUsername || !username) return s;
          let low_s = s.toLowerCase();
          const low_u = username.toLowerCase();
          let pos = 0;
          while ((pos = low_s.indexOf(low_u, pos)) !== -1) {
            let s_arr = s.split("");
            for (let k = 0; k < low_u.length && pos + k < s.length; ++k) {
              s_arr[pos + k] = rand_from(pool_all);
            }
            s = s_arr.join("");
            low_s = s.toLowerCase();
            pos += 1;
          }
          return s;
        };

        let attempts = 0;
        let currentCandidate = candidate;

        while (
          !check_policy(currentCandidate, username, policy) &&
          attempts < 500
        ) {
          currentCandidate = remove_username(currentCandidate);

          if (currentCandidate.length > policy.maxL) {
            currentCandidate = currentCandidate.substring(0, policy.maxL);
            currentCandidate = remove_username(currentCandidate);
          }
          if (currentCandidate.length < policy.minL) {
            currentCandidate += rand_chars(
              policy.minL - currentCandidate.length,
              pool_all
            );
          }

          let hasLower = /[a-z]/.test(currentCandidate);
          let hasUpper = /[A-Z]/.test(currentCandidate);
          let hasDigit = /[0-9]/.test(currentCandidate);
          let hasSpec =
            policy.specials &&
            new RegExp(
              `[${policy.specials.replace(/[-\/\\^$*+?.()|[\]{}]/g, "\\$&")}]`
            ).test(currentCandidate);

          let candidateArr = currentCandidate.split("");
          let idx = Array.from(Array(candidateArr.length).keys());
          shuffle(idx);
          let ix = 0;

          if (policy.requireLower && !hasLower && ix < idx.length)
            candidateArr[idx[ix++]] = rand_from(lowers);
          if (policy.requireUpper && !hasUpper && ix < idx.length)
            candidateArr[idx[ix++]] = rand_from(uppers);
          if (policy.requireDigit && !hasDigit && ix < idx.length)
            candidateArr[idx[ix++]] = rand_from(digits);
          if (
            policy.requireSpec &&
            !hasSpec &&
            ix < idx.length &&
            policy.specials
          )
            candidateArr[idx[ix++]] = rand_from(policy.specials);

          currentCandidate = candidateArr.join("");

          if (currentCandidate.length < policy.minL) {
            currentCandidate += rand_chars(
              policy.minL - currentCandidate.length,
              pool_all
            );
          }

          currentCandidate = shuffle(currentCandidate);
          attempts++;
        }

        if (!check_policy(currentCandidate, username, policy)) {
          let pw = "";
          if (policy.requireLower) pw += rand_from(lowers);
          if (policy.requireUpper) pw += rand_from(uppers);
          if (policy.requireDigit) pw += rand_from(digits);
          if (policy.requireSpec && policy.specials)
            pw += rand_from(policy.specials);

          const remaining = Math.max(policy.minL, pw.length) - pw.length;
          if (remaining > 0) pw += rand_chars(remaining, pool_all);

          currentCandidate = shuffle(pw.substring(0, policy.maxL));
        }

        return currentCandidate.substring(0, policy.maxL);
      };

      // --- DOM Interaction ---
      const enforceBtn = document.getElementById("enforce-btn");
      const candidateInput = document.getElementById("candidate");
      const usernameInput = document.getElementById("username");
      const resultContainer = document.getElementById("result-container");
      const resultInput = document.getElementById("result");
      const copyBtn = document.getElementById("copy-btn");
      const messageBox = document.getElementById("message-box");
      const togglePolicyBtn = document.getElementById("toggle-policy-btn");
      const policySettings = document.getElementById("policy-settings");
      const policyArrow = document.getElementById("policy-arrow");

      const getPolicySettings = () => ({
        minL: parseInt(document.getElementById("minL").value, 10) || 8,
        maxL: parseInt(document.getElementById("maxL").value, 10) || 16,
        requireLower: document.getElementById("reqLower").checked,
        requireUpper: document.getElementById("reqUpper").checked,
        requireDigit: document.getElementById("reqDigit").checked,
        requireSpec: document.getElementById("reqSpec").checked,
        noUsername: document.getElementById("noUser").checked,
        specials: document.getElementById("specials").value,
      });

      enforceBtn.addEventListener("click", () => {
        const candidate = candidateInput.value;
        const username = usernameInput.value;
        const policy = getPolicySettings();

        const enforced = enforce(candidate, username, policy);
        resultInput.value = enforced;

        resultContainer.classList.remove("hidden");
        resultContainer.classList.add("fade-in");
      });

      candidateInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") enforceBtn.click();
      });

      copyBtn.addEventListener("click", () => {
        if (navigator.clipboard) {
          navigator.clipboard
            .writeText(resultInput.value)
            .then(showCopyMessage);
        } else {
          resultInput.select();
          document.execCommand("copy");
          showCopyMessage();
        }
      });

      function showCopyMessage() {
        messageBox.classList.remove("translate-x-full");
        setTimeout(() => messageBox.classList.add("translate-x-full"), 2000);
      }

      togglePolicyBtn.addEventListener("click", () => {
        const isHidden = policySettings.classList.contains("slide-up");
        if (isHidden) {
          policySettings.classList.remove("slide-up");
          policySettings.classList.add("slide-down");
          policyArrow.style.transform = "rotate(180deg)";
        } else {
          policySettings.classList.remove("slide-down");
          policySettings.classList.add("slide-up");
          policyArrow.style.transform = "rotate(0deg)";
        }
      });
    </script>
  </body>
</html>
